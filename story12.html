<!DOCTYPE html>
<html lang="ko">
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f8f9fa;
        /* ìˆ˜ì •: ì „ì²´ í„°ì¹˜ ì¡°ì‘ ëŒ€ì‹  ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ê¸°ë³¸ì ìœ¼ë¡œ í—ˆìš©í•©ë‹ˆë‹¤. */
        touch-action: pan-y;
      }
      
      /* ìƒë‹¨ ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ ì˜ì—­ */
      #intro-images {
        width: 100%;
        max-width: 480px;
        line-height: 0; /* ì´ë¯¸ì§€ ì‚¬ì´ ê°„ê²© ì œê±° */
      }
      #intro-images img {
        width: 100%;
        height: auto;
        display: block;
      }

      #wrapper {
        width: 100%;
        max-width: 480px;
        padding: 20px 10px;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #puzzle-board {
        width: 100%;
        aspect-ratio: 4 / 2;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 2px;
        border: 3px solid #333;
        position: relative;
        background-color: #eee;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      .puzzle-slot {
        border: 1px dashed #bbb;
        position: relative;
        overflow: hidden;
        background-color: rgba(255, 255, 255, 0.5);
      }
      .puzzle-slot .puzzle-piece {
        position: absolute;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
      }

      #piece-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-top: 25px;
        min-height: 120px;
        width: 100%;
        padding: 10px;
        background: #fff;
        border-radius: 12px;
        border: 1px solid #ddd;
        align-content: flex-start;
      }
      .puzzle-piece {
        width: calc((100% - 3 * 8px) / 4);
        aspect-ratio: 1 / 1;
        background-image: url('https://i.imgur.com/r4ORRmx.png');
        background-size: 400% 200%;
        cursor: grab;
        position: relative;
        z-index: 10;
        flex-shrink: 0;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        /* ì¶”ê°€: í¼ì¦ ì¡°ê°ì„ ì¡ê³  ì›€ì§ì¼ ë•ŒëŠ” í™”ë©´ì´ ìŠ¤í¬ë¡¤ë˜ì§€ ì•Šë„ë¡ ê³ ì •í•©ë‹ˆë‹¤. */
        touch-action: none;
      }
      .puzzle-piece:active {
        cursor: grabbing;
      }

      #check-button {
        display: none;
        margin-top: 20px;
        width: 100%;
        padding: 15px;
        font-size: 18px;
        font-weight: bold;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 20;
        box-shadow: 0 4px 0 #388E3C;
        transition: transform 0.1s;
      }
      #check-button:active {
        transform: translateY(2px);
        box-shadow: 0 2px 0 #388E3C;
      }

      #reset-button {
        margin-top: 15px;
        padding: 8px 16px;
        font-size: 14px;
        background: #f44336;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        opacity: 0.8;
      }

      #instruction {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 16px;
        color: #888;
        text-align: center;
        width: 100%;
        pointer-events: none;
        z-index: 5;
      }
    </style>
  </head>
  <body>
    <!-- ìƒë‹¨ ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ -->
    <div id="intro-images">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_1.png" alt="12-1">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_2.png" alt="12-2">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_3.png" alt="12-3">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_4.png" alt="12-4">
    </div>

    <div id="wrapper">
      <div id="puzzle-board">
        <div id="instruction">ğŸ§© ì—¬ê¸°ë¡œ í¼ì¦ ì¡°ê°ì„ ëŒì–´ì˜¤ì„¸ìš”</div>
      </div>
      
      <!-- ì„±ê³µ ë²„íŠ¼ (í˜„ì¬ ì°½ì—ì„œ ì´ë™) -->
      <button id="check-button" onclick="goToNextStep()">ì „ìí”¼ì•„ë…¸ íšŒë¡œ íšë“</button>
      
      <div id="piece-container"></div>
      
      <button id="reset-button" onclick="resetPuzzle()">í¼ì¦ ë‹¤ì‹œ ì„ê¸°</button>
    </div>

    <script>
      const board = document.getElementById('puzzle-board');
      const container = document.getElementById('piece-container');
      const checkButton = document.getElementById('check-button');
      const instruction = document.getElementById('instruction');
      const targetUrl = "https://realmetawinner.github.io/welcome-highschool/story13.html";

      const rows = 2;
      const cols = 4;
      let pieces = [];
      let dragged = null;

      function goToNextStep() {
        // í˜„ì¬ ì°½ì—ì„œ í˜ì´ì§€ ì „í™˜
        window.location.href = targetUrl;
      }

      function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
      }

      function createPuzzlePieces() {
        pieces = [];
        for (let i = 0; i < rows * cols; i++) {
          const piece = document.createElement('div');
          piece.className = 'puzzle-piece';
          piece.draggable = true;
          piece.dataset.index = i;
          
          // ë°°ê²½ ì´ë¯¸ì§€ ìœ„ì¹˜ ê³„ì‚° (4x2 ë¹„ìœ¨ì— ë§ì¶¤)
          const posX = (i % cols) * (100 / (cols - 1));
          const posY = Math.floor(i / cols) * 100;
          piece.style.backgroundPosition = `${posX}% ${posY}%`;
          
          piece.addEventListener('dragstart', dragStart);
          pieces.push(piece);
        }
        shuffle(pieces);
      }

      function renderPuzzle() {
        // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
        board.querySelectorAll('.puzzle-slot').forEach(slot => slot.remove());
        container.innerHTML = '';
        checkButton.style.display = 'none';
        instruction.style.display = 'block';

        // ìŠ¬ë¡¯ ìƒì„±
        for (let i = 0; i < rows * cols; i++) {
          const slot = document.createElement('div');
          slot.className = 'puzzle-slot';
          slot.dataset.index = i;
          slot.addEventListener('dragover', dragOver);
          slot.addEventListener('drop', drop);
          board.appendChild(slot);
        }

        // ì„ì¸ ì¡°ê°ë“¤ì„ ì»¨í…Œì´ë„ˆì— ë°°ì¹˜
        pieces.forEach(piece => {
          container.appendChild(piece);
        });
      }

      function dragStart(e) {
        dragged = e.target;
      }

      function dragOver(e) {
        e.preventDefault();
      }

      function drop(e) {
        let targetSlot = e.target;
        
        // ì¡°ê° ìœ„ì— ë“œë¡­í–ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ìŠ¬ë¡¯ì„ ì°¾ìŒ
        if (!targetSlot.classList.contains('puzzle-slot')) {
          targetSlot = targetSlot.closest('.puzzle-slot');
        }

        if (targetSlot && targetSlot.classList.contains('puzzle-slot') && targetSlot.children.length === 0) {
          dragged.style.position = 'absolute';
          dragged.style.left = '0';
          dragged.style.top = '0';
          targetSlot.appendChild(dragged);
          checkComplete();
        }
      }

      function checkComplete() {
        const slots = document.querySelectorAll('.puzzle-slot');
        let filledCount = 0;
        let correctCount = 0;

        slots.forEach(slot => {
          if (slot.children.length > 0) {
            filledCount++;
            const piece = slot.children[0];
            if (piece.dataset.index == slot.dataset.index) {
              correctCount++;
            }
          }
        });

        // ì¡°ê°ì„ í•˜ë‚˜ë¼ë„ ì˜¬ë¦¬ë©´ ì•ˆë‚´ ë¬¸êµ¬ ì œê±°
        if (filledCount > 0) instruction.style.display = 'none';

        // ëª¨ë“  ì¡°ê°ì´ ì œìë¦¬ì— ìˆì„ ë•Œë§Œ ë²„íŠ¼ í‘œì‹œ
        if (correctCount === rows * cols) {
          checkButton.style.display = 'block';
        } else {
          checkButton.style.display = 'none';
        }
      }

      function resetPuzzle() {
        createPuzzlePieces();
        renderPuzzle();
      }

      // ì´ˆê¸° ì‹¤í–‰
      createPuzzlePieces();
      renderPuzzle();
    </script>
  </body>
</html>
