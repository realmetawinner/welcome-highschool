<!DOCTYPE html>
<html lang="ko">
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- ëª¨ë°”ì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì› í´ë¦¬í•„ -->
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <style>
      * {
        box-sizing: border-box;
      }
      
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        /* í˜ì´ì§€ ì „ì²´ì—ì„œ ì„¸ë¡œ ìŠ¤í¬ë¡¤ì€ í—ˆìš©í•˜ë˜ ê°€ë¡œ ìŠ¤í¬ë¡¤ì€ ë°©ì§€ */
        overflow-x: hidden;
        background-color: #f8f9fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        /* ê¸°ë³¸ì ìœ¼ë¡œ ì„¸ë¡œ ìŠ¤í¬ë¡¤(pan-y)ì„ í—ˆìš© */
        touch-action: pan-y;
      }
      
      /* ìƒë‹¨ ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ í”„ë ˆì„ (ì´ ì˜ì—­ì€ ìŠ¤í¬ë¡¤ì´ ì•„ì£¼ ì˜ ë˜ì–´ì•¼ í•¨) */
      #intro-images-container {
        width: 100%;
        max-width: 480px;
        line-height: 0;
        background-color: #fff;
        /* í„°ì¹˜ ì‹œ ìŠ¤í¬ë¡¤ì´ ì¦‰ì‹œ ì‘ë™í•˜ë„ë¡ ì„¤ì • */
        touch-action: pan-y;
      }
      
      #intro-images-container img {
        width: 100%;
        height: auto;
        display: block;
      }

      #game-wrapper {
        width: 100%;
        max-width: 480px;
        padding: 20px 15px 50px 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* ê²Œì„ ì˜ì—­ ë°°ê²½ë„ ìŠ¤í¬ë¡¤ í—ˆìš© */
        touch-action: pan-y;
      }

      /* í¼ì¦ íŒ */
      #puzzle-board {
        width: 100%;
        aspect-ratio: 4 / 2;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 2px;
        border: 4px solid #333;
        position: relative;
        background-color: #ddd;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        /* íŒ ìœ„ì—ì„œë„ ë¹ˆ ê³µê°„ ë“œë˜ê·¸ ì‹œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ í•¨ */
        touch-action: pan-y;
      }

      .puzzle-slot {
        border: 1px dashed #bbb;
        position: relative;
        overflow: hidden;
        background-color: rgba(255, 255, 255, 0.6);
      }

      /* í¼ì¦ ì¡°ê° (ì‹¤ì œ ë“œë˜ê·¸ë˜ëŠ” ìš”ì†Œ) */
      .puzzle-piece {
        width: calc((100% - 3 * 8px) / 4);
        aspect-ratio: 1 / 1;
        background-image: url('https://i.imgur.com/r4ORRmx.png');
        background-size: 400% 200%;
        cursor: grab;
        position: relative;
        z-index: 10;
        flex-shrink: 0;
        border-radius: 6px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        /* ì¤‘ìš”: ì¡°ê°ì„ ì¡ì•˜ì„ ë•ŒëŠ” í™”ë©´ì´ ìŠ¤í¬ë¡¤ë˜ì§€ ì•Šê³  ì¡°ê°ì´ ì›€ì§ì—¬ì•¼ í•¨ */
        touch-action: none;
      }

      /* ìŠ¬ë¡¯ ì•ˆì— ë“¤ì–´ê°„ í¼ì¦ ì¡°ê° ìŠ¤íƒ€ì¼ */
      .puzzle-slot .puzzle-piece {
        position: absolute;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
        box-shadow: none;
        border-radius: 0;
      }

      #piece-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-top: 30px;
        min-height: 130px;
        width: 100%;
        padding: 15px;
        background: #ffffff;
        border-radius: 15px;
        border: 2px solid #eee;
        align-content: flex-start;
        /* ì¡°ê° ì‚¬ì´ ê³µê°„ í„°ì¹˜ ì‹œ ìŠ¤í¬ë¡¤ í—ˆìš© */
        touch-action: pan-y;
      }

      /* ê²°ê³¼ í™•ì¸ ë° ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ */
      #check-button {
        display: none;
        margin-top: 25px;
        width: 100%;
        padding: 18px;
        font-size: 20px;
        font-weight: bold;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 5px 0 #27ae60;
        transition: all 0.1s;
      }
      
      #check-button:active {
        transform: translateY(3px);
        box-shadow: 0 2px 0 #27ae60;
      }

      #reset-button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 15px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
      }

      #instruction {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 17px;
        color: #777;
        text-align: center;
        width: 100%;
        pointer-events: none;
        z-index: 5;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <!-- ìƒë‹¨ ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ í”„ë ˆì„ -->
    <div id="intro-images-container">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_1.png" alt="12-1">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_2.png" alt="12-2">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_3.png" alt="12-3">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_4.png" alt="12-4">
    </div>

    <div id="game-wrapper">
      <!-- í¼ì¦ ë³´ë“œ ì˜ì—­ -->
      <div id="puzzle-board">
        <div id="instruction">ğŸ§© ì¡°ê°ì„ ë“œë˜ê·¸í•˜ì—¬ ë§ì¶”ì„¸ìš”</div>
      </div>
      
      <!-- ì„±ê³µ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ë²„íŠ¼ -->
      <button id="check-button" onclick="goToNextStep()">ì „ìí”¼ì•„ë…¸ íšŒë¡œ íšë“</button>
      
      <!-- ì„ì—¬ìˆëŠ” ì¡°ê°ë“¤ ë³´ê´€í•¨ -->
      <div id="piece-container"></div>
      
      <button id="reset-button" onclick="resetPuzzle()">í¼ì¦ ë‹¤ì‹œ ì„ê¸°</button>
    </div>

    <script>
      const board = document.getElementById('puzzle-board');
      const container = document.getElementById('piece-container');
      const checkButton = document.getElementById('check-button');
      const instruction = document.getElementById('instruction');
      const targetUrl = "https://realmetawinner.github.io/welcome-highschool/story13.html";

      const rows = 2;
      const cols = 4;
      let pieces = [];
      let dragged = null;

      // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
      function goToNextStep() {
        window.location.href = targetUrl;
      }

      // ë°°ì—´ ì…”í”Œ
      function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
      }

      // ì¡°ê° ìƒì„± ë° ë°°ê²½ ì„¤ì •
      function createPuzzlePieces() {
        pieces = [];
        for (let i = 0; i < rows * cols; i++) {
          const piece = document.createElement('div');
          piece.className = 'puzzle-piece';
          piece.draggable = true;
          piece.dataset.index = i;
          
          // ë°°ê²½ ì´ë¯¸ì§€ ìŠ¤í”„ë¼ì´íŠ¸ ì¢Œí‘œ ê³„ì‚°
          const posX = (i % cols) * (100 / (cols - 1));
          const posY = Math.floor(i / cols) * 100;
          piece.style.backgroundPosition = `${posX}% ${posY}%`;
          
          piece.addEventListener('dragstart', dragStart);
          pieces.push(piece);
        }
        shuffle(pieces);
      }

      // í™”ë©´ì— í¼ì¦ ë Œë”ë§
      function renderPuzzle() {
        board.querySelectorAll('.puzzle-slot').forEach(slot => slot.remove());
        container.innerHTML = '';
        checkButton.style.display = 'none';
        instruction.style.display = 'block';

        for (let i = 0; i < rows * cols; i++) {
          const slot = document.createElement('div');
          slot.className = 'puzzle-slot';
          slot.dataset.index = i;
          slot.addEventListener('dragover', dragOver);
          slot.addEventListener('drop', drop);
          board.appendChild(slot);
        }

        pieces.forEach(piece => {
          container.appendChild(piece);
        });
      }

      function dragStart(e) {
        dragged = e.target;
      }

      function dragOver(e) {
        e.preventDefault();
      }

      function drop(e) {
        let targetSlot = e.target;
        
        // ì¡°ê° ìœ„ì— ë“œë¡­í–ˆì„ ë•Œ ë¶€ëª¨ ìŠ¬ë¡¯ì„ ì°¾ì•„ê°
        if (!targetSlot.classList.contains('puzzle-slot')) {
          targetSlot = targetSlot.closest('.puzzle-slot');
        }

        if (targetSlot && targetSlot.classList.contains('puzzle-slot') && targetSlot.children.length === 0) {
          targetSlot.appendChild(dragged);
          checkComplete();
        }
      }

      // ì™„ì„± ì—¬ë¶€ í™•ì¸
      function checkComplete() {
        const slots = document.querySelectorAll('.puzzle-slot');
        let filledCount = 0;
        let correctCount = 0;

        slots.forEach(slot => {
          if (slot.children.length > 0) {
            filledCount++;
            const piece = slot.children[0];
            if (piece.dataset.index == slot.dataset.index) {
              correctCount++;
            }
          }
        });

        if (filledCount > 0) instruction.style.display = 'none';

        // ëª¨ë“  ì¡°ê°ì´ ì •í™•í•œ ìœ„ì¹˜ì— ìˆì„ ë•Œ ë²„íŠ¼ ë…¸ì¶œ
        if (correctCount === rows * cols) {
          checkButton.style.display = 'block';
          checkButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          checkButton.style.display = 'none';
        }
      }

      function resetPuzzle() {
        createPuzzlePieces();
        renderPuzzle();
      }

      // ì´ˆê¸°í™” ì‹¤í–‰
      createPuzzlePieces();
      renderPuzzle();
    </script>
  </body>
</html>
