<!DOCTYPE html>
<html lang="ko">
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- ëª¨ë°”ì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì› í´ë¦¬í•„ -->
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <style>
      /* ì „ì²´ ì´ˆê¸°í™” ë° ìŠ¤í¬ë¡¤ ìµœì í™” */
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ì€ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘(pan-y)ì„ ë”°ë¥´ë„ë¡ ê°•ì œ */
        overflow-x: hidden;
        overflow-y: auto;
        height: auto;
        min-height: 100%;
        background-color: transparent;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        touch-action: pan-y;
        -webkit-overflow-scrolling: touch;
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* ì´ë¯¸ì§€ í”„ë ˆì„: ìŠ¤í¬ë¡¤ì´ ê°€ì¥ ì˜ ë˜ì–´ì•¼ í•˜ëŠ” ì˜ì—­ */
      #intro-images-container {
        width: 100%;
        max-width: 480px;
        line-height: 0;
        /* ì´ ì˜ì—­ í„°ì¹˜ ì‹œ ìŠ¤í¬ë¡¤ì´ ì¦‰ì‹œ ì‘ë™í•˜ë„ë¡ ì„¤ì • */
        touch-action: pan-y !important;
        position: relative;
        z-index: 1;
      }
      
      #intro-images-container img {
        width: 100%;
        height: auto;
        display: block;
        /* ì´ë¯¸ì§€ê°€ í„°ì¹˜ ì´ë²¤íŠ¸ë¥¼ í¡ìˆ˜í•˜ì§€ ì•Šê³  ì»¨í…Œì´ë„ˆë¡œ ë„˜ê¸°ë„ë¡ ì„¤ì • */
        pointer-events: none; 
        -webkit-user-drag: none;
      }

      #game-wrapper {
        width: 100%;
        max-width: 480px;
        padding: 10px 15px 60px 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        touch-action: pan-y !important;
      }

      /* í¼ì¦ íŒ */
      #puzzle-board {
        width: 100%;
        aspect-ratio: 4 / 2;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 2px;
        border: 4px solid #333;
        position: relative;
        background-color: #ddd;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        /* íŒ ìœ„ ë¹ˆ ê³µê°„ì—ì„œë„ ìŠ¤í¬ë¡¤ í—ˆìš© */
        touch-action: pan-y !important;
      }

      .puzzle-slot {
        border: 1px dashed #bbb;
        position: relative;
        background-color: rgba(255, 255, 255, 0.5);
      }

      /* í¼ì¦ ì¡°ê° ìŠ¤íƒ€ì¼ */
      .puzzle-piece {
        width: calc((100% - 3 * 10px) / 4);
        aspect-ratio: 1 / 1;
        background-image: url('https://i.imgur.com/r4ORRmx.png');
        background-size: 400% 200%;
        cursor: grab;
        position: relative;
        z-index: 10;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        /* ì¤‘ìš”: ì¡°ê° ìì²´ë¥¼ ì¡ì•˜ì„ ë•Œë§Œ ìŠ¤í¬ë¡¤ì„ ë§‰ê³  ë“œë˜ê·¸ë¥¼ ì‹¤í–‰ */
        touch-action: none;
        user-select: none;
        -webkit-user-select: none;
      }

      /* ìŠ¬ë¡¯ ë‚´ ê³ ì • ìƒíƒœ */
      .puzzle-slot .puzzle-piece {
        position: absolute;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
        box-shadow: none;
        border-radius: 0;
      }

      #piece-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
        min-height: 140px;
        width: 100%;
        padding: 15px;
        background: #fff;
        border-radius: 15px;
        border: 1px solid #eee;
        align-content: flex-start;
        touch-action: pan-y !important;
      }

      #check-button {
        display: none;
        margin-top: 20px;
        width: 100%;
        padding: 18px;
        font-size: 18px;
        font-weight: bold;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 0 #27ae60;
        cursor: pointer;
        touch-action: manipulation;
      }

      #reset-button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 14px;
        background: #95a5a6;
        color: white;
        border: none;
        border-radius: 6px;
        touch-action: manipulation;
      }

      #instruction {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 15px;
        color: #888;
        pointer-events: none;
        z-index: 5;
        text-align: center;
        width: 100%;
      }

      /* ì•ˆë‚´ í…ìŠ¤íŠ¸ */
      .scroll-guide {
        font-size: 12px;
        color: #ff5e5e;
        margin-bottom: 10px;
        font-weight: bold;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- ìƒë‹¨ ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ -->
    <div id="intro-images-container">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_1.png" alt="12-1">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_2.png" alt="12-2">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_3.png" alt="12-3">
      <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story12_4.png" alt="12-4">
    </div>

    <div id="game-wrapper">
      <div class="scroll-guide">â†• í™”ë©´ ì´ë™ ì‹œ ì´ë¯¸ì§€ ì˜ì—­ì„ ë°€ì–´ì£¼ì„¸ìš”.</div>
      
      <div id="puzzle-board">
        <div id="instruction">ğŸ§© ì¡°ê°ì„ ì—¬ê¸°ì— ë§ì¶”ì„¸ìš”</div>
      </div>
      
      <button id="check-button" onclick="goToNextStep()">ì „ìí”¼ì•„ë…¸ íšŒë¡œ íšë“</button>
      
      <div id="piece-container"></div>
      
      <button id="reset-button" onclick="resetPuzzle()">í¼ì¦ ë‹¤ì‹œ ì„ê¸°</button>
    </div>

    <script>
      const board = document.getElementById('puzzle-board');
      const container = document.getElementById('piece-container');
      const checkButton = document.getElementById('check-button');
      const instruction = document.getElementById('instruction');
      const targetUrl = "https://realmetawinner.github.io/welcome-highschool/story13.html";

      const rows = 2;
      const cols = 4;
      let pieces = [];
      let dragged = null;

      function goToNextStep() {
        window.location.href = targetUrl;
      }

      function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
      }

      function createPuzzlePieces() {
        pieces = [];
        for (let i = 0; i < rows * cols; i++) {
          const piece = document.createElement('div');
          piece.className = 'puzzle-piece';
          piece.draggable = true;
          piece.dataset.index = i;
          
          const posX = (i % cols) * (100 / (cols - 1));
          const posY = Math.floor(i / cols) * 100;
          piece.style.backgroundPosition = `${posX}% ${posY}%`;
          
          piece.addEventListener('dragstart', (e) => { dragged = e.target; });
          pieces.push(piece);
        }
        shuffle(pieces);
      }

      function renderPuzzle() {
        board.querySelectorAll('.puzzle-slot').forEach(slot => slot.remove());
        container.innerHTML = '';
        checkButton.style.display = 'none';
        instruction.style.display = 'block';

        for (let i = 0; i < rows * cols; i++) {
          const slot = document.createElement('div');
          slot.className = 'puzzle-slot';
          slot.dataset.index = i;
          slot.addEventListener('dragover', (e) => e.preventDefault());
          slot.addEventListener('drop', handleDrop);
          board.appendChild(slot);
        }

        pieces.forEach(p => container.appendChild(p));
      }

      function handleDrop(e) {
        let slot = e.target.classList.contains('puzzle-slot') ? e.target : e.target.closest('.puzzle-slot');
        if (slot && slot.children.length === 0) {
          slot.appendChild(dragged);
          checkComplete();
        }
      }

      function checkComplete() {
        const slots = document.querySelectorAll('.puzzle-slot');
        let filled = 0, correct = 0;

        slots.forEach(slot => {
          if (slot.children.length > 0) {
            filled++;
            if (slot.children[0].dataset.index == slot.dataset.index) correct++;
          }
        });

        if (filled > 0) instruction.style.display = 'none';
        if (correct === rows * cols) {
          checkButton.style.display = 'block';
          checkButton.scrollIntoView({ behavior: 'smooth' });
        } else {
          checkButton.style.display = 'none';
        }
      }

      function resetPuzzle() {
        createPuzzlePieces();
        renderPuzzle();
      }

      createPuzzlePieces();
      renderPuzzle();
    </script>
  </body>
</html>
