<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Highschool - Story 3 & Light Simulator</title>
    <!-- Tailwind CSS 사용 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #000;
            --bg-color: #ffffff;
            --modal-bg: rgba(0, 0, 0, 0.7);
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow-x: hidden;
        }

        /* 스토리 이미지 섹션 */
        .image-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
        }

        img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* 조명 시뮬레이터 섹션 */
        .light-simulator-section {
            width: 100%;
            max-width: 800px;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fff;
        }

        .light-display-box {
            position: relative;
            width: 300px;
            height: 300px;
            background-color: #000;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .circle {
            position: absolute;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            mix-blend-mode: screen;
            transition: opacity 0.4s ease-in-out;
            opacity: 0;
            filter: blur(10px);
        }

        #light-red { background-color: #ff0000; top: 35px; left: 70px; }
        #light-green { background-color: #00ff00; bottom: 35px; right: 40px; }
        #light-blue { background-color: #0000ff; bottom: 35px; left: 40px; }
        .active { opacity: 1; }

        /* 세로형 토글 스위치 */
        .switch {
            position: relative;
            display: inline-block;
            width: 26px;
            height: 50px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider:before { transform: translateY(-24px); }
        input:checked + .slider.red { background-color: #ef4444; }
        input:checked + .slider.blue { background-color: #3b82f6; }
        input:checked + .slider.green { background-color: #22c55e; }

        .status-label { font-size: 0.7rem; font-weight: 800; transition: color 0.3s; color: #d1d5db; }
        .status-on.active-on { color: #1f2937; }
        .status-off.active-off { color: #1f2937; }

        /* 자물쇠 UI 섹션 */
        .lock-section {
            width: 100%;
            max-width: 800px;
            padding: 20px 20px 60px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lock-container {
            position: relative;
            background: #e5e7eb;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            gap: 8px;
            border: 4px solid #9ca3af;
        }

        .lock-handle {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 70px;
            border: 12px solid #9ca3af;
            border-bottom: none;
            border-top-left-radius: 75px;
            border-top-right-radius: 75px;
            z-index: -1;
        }

        /* 다이얼 프레임 (마스킹 영역) */
        .dial-frame {
            width: 54px;
            height: 70px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden; /* 영역 밖 글자 숨김 */
            position: relative;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), inset 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid #d1d5db;
            touch-action: none;
        }

        /* 회전하는 알파벳 스트립 */
        .dial-strip {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            /* 초기 트랜지션 설정 - 0.3s 동안 부드럽게 이동 */
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 개별 글자 칸 */
        .dial-char {
            height: 66px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 900;
            color: #374151;
            user-select: none;
        }

        .dial-frame:hover {
            border-color: #9ca3af;
        }

        .dial-frame:active {
            background-color: #f3f4f6;
        }

        /* 성공 애니메이션 */
        @keyframes unlock {
            0% { transform: translateY(0); }
            30% { transform: translateY(-15px); }
            100% { transform: translateY(0); }
        }
        .unlocked-anim {
            animation: unlock 0.6s ease-in-out;
        }
    </style>
</head>
<body>

    <!-- 스토리 이미지 영역 -->
    <div class="image-container">
        <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story3_1.png" alt="스토리3 이미지 1">
        <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story3_2.png" alt="스토리3 이미지 2">
        <img src="https://raw.githubusercontent.com/realmetawinner/welcome-highschool/main/images/story3_3.png" alt="스토리3 이미지 3">
    </div>

    <!-- 조명 시뮬레이터 영역 -->
    <div class="light-simulator-section">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">빛의 삼원색 합성 실험</h2>
            <p class="text-gray-500">세로 스위치를 사용하여 조명의 합성을 확인하세요.</p>
        </div>

        <div class="light-display-box">
            <div id="light-red" class="circle"></div>
            <div id="light-green" class="circle"></div>
            <div id="light-blue" class="circle"></div>
        </div>

        <div class="grid grid-cols-3 gap-8 w-full max-w-sm mb-12">
            <div class="flex flex-col items-center">
                <span id="on-red" class="status-label status-on mb-1">ON</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-red" onchange="updateLights()">
                    <span class="slider red"></span>
                </label>
                <span id="off-red" class="status-label status-off mt-1 active-off">OFF</span>
                <p class="mt-4 font-bold text-gray-700 text-sm italic">RED</p>
            </div>
            <div class="flex flex-col items-center">
                <span id="on-blue" class="status-label status-on mb-1">ON</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-blue" onchange="updateLights()">
                    <span class="slider blue"></span>
                </label>
                <span id="off-blue" class="status-label status-off mt-1 active-off">OFF</span>
                <p class="mt-4 font-bold text-gray-700 text-sm italic">BLUE</p>
            </div>
            <div class="flex flex-col items-center">
                <span id="on-green" class="status-label status-on mb-1">ON</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-green" onchange="updateLights()">
                    <span class="slider green"></span>
                </label>
                <span id="off-green" class="status-label status-off mt-1 active-off">OFF</span>
                <p class="mt-4 font-bold text-gray-700 text-sm italic">GREEN</p>
            </div>
        </div>
    </div>

    <!-- 자물쇠 UI 영역 -->
    <div class="lock-section">
        <div class="text-center mb-10">
            <h3 class="text-xl font-bold text-gray-800 mb-1">암호 자물쇠</h3>
            <p class="text-gray-500 text-sm">클릭하거나 휠을 굴려 암호를 맞추세요.</p>
        </div>

        <div id="lock-body" class="lock-container">
            <div class="lock-handle"></div>
            <div id="frame-0" class="dial-frame" onclick="rotateDial(0, 1)">
                <div id="strip-0" class="dial-strip"></div>
            </div>
            <div id="frame-1" class="dial-frame" onclick="rotateDial(1, 1)">
                <div id="strip-1" class="dial-strip"></div>
            </div>
            <div id="frame-2" class="dial-frame" onclick="rotateDial(2, 1)">
                <div id="strip-2" class="dial-strip"></div>
            </div>
            <div id="frame-3" class="dial-frame" onclick="rotateDial(3, 1)">
                <div id="strip-3" class="dial-strip"></div>
            </div>
            <div id="frame-4" class="dial-frame" onclick="rotateDial(4, 1)">
                <div id="strip-4" class="dial-strip"></div>
            </div>
        </div>
    </div>

    <script>
        const targetUrl = "https://realmetawinner.github.io/welcome-highschool/story4.html";
        const answer = "WHITE";
        const alphabetPool = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        
        // 실제 데이터상의 인덱스 (0-7)
        const lockState = [0, 0, 0, 0, 0];
        // 시각적 트래킹을 위한 인덱스 (끊김 없는 회전을 위해 계속 누적됨)
        const visualState = [8, 8, 8, 8, 8]; 
        
        const dialOptions = [];
        const CHAR_HEIGHT = 66; 

        function initLock() {
            for (let i = 0; i < 5; i++) {
                let options = [answer[i]];
                while (options.length < 8) {
                    let randomChar = alphabetPool[Math.floor(Math.random() * alphabetPool.length)];
                    if (!options.includes(randomChar)) options.push(randomChar);
                }
                options.sort(() => Math.random() - 0.5);
                dialOptions.push(options);

                const strip = document.getElementById(`strip-${i}`);
                
                // 무한 루프를 위해 동일 세트를 3번 반복 생성 (8 * 3 = 24개)
                // [이전 세트] [메인 세트] [다음 세트]
                const tripleOptions = [...options, ...options, ...options];
                
                tripleOptions.forEach(char => {
                    const charDiv = document.createElement('div');
                    charDiv.className = 'dial-char';
                    charDiv.innerText = char;
                    strip.appendChild(charDiv);
                });

                // 초기 위치를 중간 세트의 첫 번째 글자로 설정 (인덱스 8)
                strip.style.transition = 'none';
                strip.style.transform = `translateY(-${visualState[i] * CHAR_HEIGHT}px)`;
                
                // 리플로우 강제 후 트랜지션 복구
                strip.offsetHeight; 
                strip.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';

                const frame = document.getElementById(`frame-${i}`);
                frame.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    if (e.deltaY > 0) rotateDial(i, 1);
                    else rotateDial(i, -1);
                }, { passive: false });
            }
        }

        /**
         * 다이얼 회전 로직 (무한 스크롤 적용)
         */
        function rotateDial(index, direction = 1) {
            const strip = document.getElementById(`strip-${index}`);
            
            // 시각적 인덱스 업데이트
            visualState[index] += direction;
            strip.style.transform = `translateY(-${visualState[index] * CHAR_HEIGHT}px)`;

            // 실제 정답 체크용 상태 업데이트 (0-7 순환)
            lockState[index] = (lockState[index] + direction + 8) % 8;

            // 트랜지션이 끝난 후 경계를 넘었는지 확인하여 위치 재조정 (Silent Jump)
            // 메인 세트 영역(8~15)을 벗어나면 중간 세트로 즉시 이동
            setTimeout(() => {
                if (visualState[index] >= 16) { // '다음 세트'의 시작 부분에 도달 시
                    visualState[index] -= 8; // '메인 세트'의 동일 위치로
                    strip.style.transition = 'none';
                    strip.style.transform = `translateY(-${visualState[index] * CHAR_HEIGHT}px)`;
                    strip.offsetHeight; // 적용을 위해 리플로우 발생
                    strip.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                } else if (visualState[index] < 8) { // '이전 세트' 영역 진입 시
                    visualState[index] += 8; // '메인 세트'의 동일 위치로
                    strip.style.transition = 'none';
                    strip.style.transform = `translateY(-${visualState[index] * CHAR_HEIGHT}px)`;
                    strip.offsetHeight;
                    strip.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                }
            }, 300); // CSS 트랜지션 시간(0.3s)과 일치시킴

            checkLock();
        }

        function checkLock() {
            let currentCombo = "";
            for (let i = 0; i < 5; i++) {
                currentCombo += dialOptions[i][lockState[i]];
            }

            if (currentCombo === answer) {
                const lockBody = document.getElementById('lock-body');
                lockBody.classList.add('unlocked-anim');
                lockBody.style.borderColor = "#10b981";
                
                document.querySelectorAll('.dial-frame').forEach(f => f.style.pointerEvents = 'none');
                
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 800);
            }
        }

        function updateLights() {
            const red = document.getElementById('toggle-red').checked;
            const blue = document.getElementById('toggle-blue').checked;
            const green = document.getElementById('toggle-green').checked;

            updateUI('light-red', red, 'red');
            updateUI('light-blue', blue, 'blue');
            updateUI('light-green', green, 'green');
        }

        function updateUI(lightId, isOn, colorName) {
            const light = document.getElementById(lightId);
            if (isOn) light.classList.add('active');
            else light.classList.remove('active');

            const onLabel = document.getElementById(`on-${colorName}`);
            const offLabel = document.getElementById(`off-${colorName}`);
            
            if (isOn) {
                onLabel.classList.add('active-on');
                offLabel.classList.remove('active-off');
            } else {
                onLabel.classList.remove('active-on');
                offLabel.classList.add('active-off');
            }
        }

        window.onload = function() {
            updateLights();
            initLock();
        };
    </script>
</body>
</html>
